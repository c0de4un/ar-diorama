#!/bin/bash
m4 -DAPACHE_WORKER_START_SERVERS="{{$APACHE_WORKER_START_SERVERS}}" \
   -DAPACHE_WORKER_MIN_SPARE_THREADS="{{$APACHE_WORKER_MIN_SPARE_THREADS}}" \
   -DAPACHE_WORKER_MAX_SPARE_THREADS="{{$APACHE_WORKER_MAX_SPARE_THREADS}}" \
   -DAPACHE_WORKER_THREAD_LIMIT="{{$APACHE_WORKER_THREAD_LIMIT}}" \
   -DAPACHE_WORKER_THREADS_PER_CHILD="{{$APACHE_WORKER_THREADS_PER_CHILD}}" \
   -DAPACHE_WORKER_MAX_REQUEST_WORKERS="{{$APACHE_WORKER_MAX_REQUEST_WORKERS}}" \
   -DAPACHE_WORKER_MAX_CONNECTIONS_PER_CHILD="{{$APACHE_WORKER_MAX_CONNECTIONS_PER_CHILD}}" /etc/apache2/mods-available/mpm_worker.conf.m4 > /etc/apache2/mods-available/mpm_worker.conf

m4 -DAPACHE_SERVER_NAME="{{$APACHE_SERVER_NAME}}" /etc/apache2/conf-available/server-name.conf.m4 > /etc/apache2/conf-available/server-name.conf

exec /usr/sbin/apache2 -D FOREGROUND $@
